<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/css/997bb99dff39a320.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-695d994ee6bbb75a.js"/><script src="/_next/static/chunks/3f5966fd-da022534e16ddcac.js" async=""></script><script src="/_next/static/chunks/313-804dc18f7265100e.js" async=""></script><script src="/_next/static/chunks/main-app-165d6d8e388c7c9d.js" async=""></script><script src="/_next/static/chunks/18-a08db35d0c492fb3.js" async=""></script><script src="/_next/static/chunks/802-8624e27f06c26e64.js" async=""></script><script src="/_next/static/chunks/app/posts/%5Bslug%5D/page-113a3a94ad4fe476.js" async=""></script><title>patching-with-pnpm | naturalclar.dev</title><meta name="description" content="
## `pnpm` で `node_modules` 内のパッケージにパッチを当てる方法

プロジェクトで `node_modules` の中にある特定のパッケージに変更を加える必要がある場面に直面した。

### `yarn` v1 での対応

以前はパッケージマネージャとして `yarn` v1 を採用していて、その時は [patch-package](https://github.com/..."/><meta name="author" content="Naturalclar (Jesse Katsumata)"/><meta name="keywords" content="react, react-native, nextjs, blog"/><meta name="creator" content="Naturalclar (Jesse Katsumata)"/><meta name="publisher" content="Naturalclar (Jesse Katsumata)"/><meta name="robots" content="index, follow"/><meta property="og:title" content="patching-with-pnpm | naturalclar.dev"/><meta property="og:description" content="
## `pnpm` で `node_modules` 内のパッケージにパッチを当てる方法

プロジェクトで `node_modules` の中にある特定のパッケージに変更を加える必要がある場面に直面した。

### `yarn` v1 での対応

以前はパッケージマネージャとして `yarn` v1 を採用していて、その時は [patch-package](https://github.com/..."/><meta property="og:url" content="https://blog.naturalclar.dev/"/><meta property="og:site_name" content="naturalclar.dev"/><meta property="og:image" content="https://blog.naturalclar.dev/twitter-card.png"/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="630"/><meta property="og:image:alt" content="patching-with-pnpm"/><meta property="og:type" content="website"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:creator" content="@natural_clar"/><meta name="twitter:title" content="patching-with-pnpm | naturalclar.dev"/><meta name="twitter:description" content="
## `pnpm` で `node_modules` 内のパッケージにパッチを当てる方法

プロジェクトで `node_modules` の中にある特定のパッケージに変更を加える必要がある場面に直面した。

### `yarn` v1 での対応

以前はパッケージマネージャとして `yarn` v1 を採用していて、その時は [patch-package](https://github.com/..."/><meta name="twitter:image" content="https://blog.naturalclar.dev/twitter-card.png"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body><div style="margin-left:auto;margin-right:auto;max-width:680px;padding:24px 12px"><h3 style="font-family:Montserrat, sans-serif;margin-top:0"><a style="box-shadow:none;text-decoration:none;color:inherit" href="/">naturalclar.dev</a></h3><h1>patching-with-pnpm</h1><p style="display:block;margin-bottom:16px">January 06, 2024</p><div><h2><code>pnpm</code> で <code>node_modules</code> 内のパッケージにパッチを当てる方法</h2>
<p>プロジェクトで <code>node_modules</code> の中にある特定のパッケージに変更を加える必要がある場面に直面した。</p>
<h3><code>yarn</code> v1 での対応</h3>
<p>以前はパッケージマネージャとして <code>yarn</code> v1 を採用していて、その時は <a href="https://github.com/ds300/patch-package">patch-package</a> を使うことで対応することができた。</p>
<p><code>patch-package</code> を使う際はまず <code>node_modules</code> の中身のファイルを必要に応じて書き換えて、その後に以下のコマンドを使うことでパッチファイルが作成できた。</p>
<pre><code class="language-sh">npx patch-package [パッケージ名]
</code></pre>
<p>パッチを反映させるには、<code>postinstall</code> 等のスクリプトで <code>patch-package</code> を実行することによって作成したパッチの内容が <code>node_modules</code> に反映された。</p>
<pre><code class="language-json">{
  "scripts": {
    "postinstall": "patch-package"
  }
}
</code></pre>
<h3><code>pnpm</code> での対応</h3>
<p><code>pnpm</code> では <code>node_modules</code> が symlink で管理されているため <code>node_modules</code> を直接書き換える対応は行えない。<code>patch-package</code> も <code>pnpm</code> には非対応である。</p>
<p>その代わり、<code>pnpm</code> は独自のパッチ機構を持っている。</p>
<h2><code>pnpm patch</code></h2>
<p><a href="https://pnpm.io/cli/patch">pnpm patch</a></p>
<pre><code class="language-sh">pnpm patch &#x3C;pkg name>@&#x3C;version>
</code></pre>
<p>実行すると以下の様なメッセージが表示され、パッケージの内容が作成される</p>
<pre><code>You can now edit the following folder: /private/var/folders/5t/lpfk4v1s7fqcpf1k1yjnnv3w0000gn/T/d9cfbc08a0261088f439bb943285e960

Once you're done with your changes, run "pnpm patch-commit /private/var/folders/5t/lpfk4v1s7fqcpf1k1yjnnv3w0000gn/T/d9cfbc08a0261088f439bb943285e960"
</code></pre>
<p>作成されたフォルダの中で必要な変更を行い、以下のコマンドを実行すると</p>
<pre><code class="language-sh">pnpm patch-commit [作成されたフォルダのパス]
</code></pre>
<p>特に他の指定をしてない場合、プロジェクトに<code>patches</code>フォルダが作成され、そこにパッチファイルが生成される。</p>
<p>また、<code>package.json</code>に以下のような記述が追記される。</p>
<pre><code class="language-json">{
  "pnpm": {
    "patchedDependencies": {
      "package@1.0.0": "patches/@package@1.0.0.patch"
    }
  }
}
</code></pre>
<p>これで次回から<code>pnpm install</code>を実行する際にパッチファイルが適用される。</p>
</div><hr style="margin-bottom:16px"/><div style="display:flex;align-items:center;margin-bottom:40px"><img alt="Naturalclar (Jesse Katsumata)" loading="lazy" width="50" height="50" decoding="async" data-nimg="1" style="color:transparent;margin-right:16px;margin-bottom:0;min-width:50px;border-radius:100%" src="https://www.github.com/Naturalclar.png"/><div style="display:flex;flex-direction:column;gap:8px"><p style="margin:0">Author: <strong>Naturalclar (Jesse Katsumata)</strong></p><p style="margin:0"><a href="https://x.com/natural_clar">X</a> <a href="https://www.github.com/Naturalclar">Github</a></p></div></div><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li><a rel="prev" href="/posts/setting-up-nvim-setting-for-windows-powershell/">← <!-- -->Windows の PowerShell で dotfiles にある neovim 用の init.vim を設定する方法</a></li><li><a rel="next" href="/posts/writing-native-module-in-swift/">React Native の Native Module を Swift で書く<!-- --> →</a></li></ul><footer>© <!-- -->2025<!-- -->, Built with<!-- --> <a href="https://nextjs.org">Next.js</a></footer></div><script src="/_next/static/chunks/webpack-695d994ee6bbb75a.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/css/997bb99dff39a320.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"2:I[8493,[],\"\"]\n5:I[3754,[],\"\"]\n7:I[7754,[],\"\"]\n8:I[7574,[\"18\",\"static/chunks/18-a08db35d0c492fb3.js\",\"802\",\"static/chunks/802-8624e27f06c26e64.js\",\"333\",\"static/chunks/app/posts/%5Bslug%5D/page-113a3a94ad4fe476.js\"],\"default\"]\n9:I[8750,[\"18\",\"static/chunks/18-a08db35d0c492fb3.js\",\"802\",\"static/chunks/802-8624e27f06c26e64.js\",\"333\",\"static/chunks/app/posts/%5Bslug%5D/page-113a3a94ad4fe476.js\"],\"\"]\nb:I[253,[],\"\"]\n6:[\"slug\",\"patching-with-pnpm\",\"d\"]\nc:[]\n0:[\"$\",\"$L2\",null,{\"buildId\":\"bVXrX63nls6mz3NDAu0w6\",\"assetPrefix\":\"\",\"urlParts\":[\"\",\"posts\",\"patching-with-pnpm\",\"\"],\"initialTree\":[\"\",{\"children\":[\"posts\",{\"children\":[[\"slug\",\"patching-with-pnpm\",\"d\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":\\\"patching-with-pnpm\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[\"posts\",{\"children\":[[\"slug\",\"patching-with-pnpm\",\"d\"],{\"children\":[\"__PAGE__\",{},[[\"$L3\",\"$L4\",null],null],null]},[null,[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\",\"$6\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]],null]},[null,[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]],null]},[[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/997bb99dff39a320.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"children\":[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFoun"])</script><script>self.__next_f.push([1,"d\":[\"$\",\"$L8\",null,{\"title\":\"naturalclar.dev\",\"children\":[[\"$\",\"h1\",null,{\"children\":\"404 - Page Not Found\"}],[\"$\",\"p\",null,{\"children\":\"You just hit a route that doesn't exist... the sadness.\"}],[\"$\",\"p\",null,{\"children\":[\"$\",\"$L9\",null,{\"href\":\"/\",\"children\":\"Go back to the homepage\"}]}]]}],\"notFoundStyles\":[]}]}]}]],null],null],\"couldBeIntercepted\":false,\"initialHead\":[null,\"$La\"],\"globalErrorComponent\":\"$b\",\"missingSlots\":\"$Wc\"}]\n"])</script><script>self.__next_f.push([1,"e:I[4802,[\"18\",\"static/chunks/18-a08db35d0c492fb3.js\",\"802\",\"static/chunks/802-8624e27f06c26e64.js\",\"333\",\"static/chunks/app/posts/%5Bslug%5D/page-113a3a94ad4fe476.js\"],\"Image\"]\nd:Tb72,"])</script><script>self.__next_f.push([1,"\u003ch2\u003e\u003ccode\u003epnpm\u003c/code\u003e で \u003ccode\u003enode_modules\u003c/code\u003e 内のパッケージにパッチを当てる方法\u003c/h2\u003e\n\u003cp\u003eプロジェクトで \u003ccode\u003enode_modules\u003c/code\u003e の中にある特定のパッケージに変更を加える必要がある場面に直面した。\u003c/p\u003e\n\u003ch3\u003e\u003ccode\u003eyarn\u003c/code\u003e v1 での対応\u003c/h3\u003e\n\u003cp\u003e以前はパッケージマネージャとして \u003ccode\u003eyarn\u003c/code\u003e v1 を採用していて、その時は \u003ca href=\"https://github.com/ds300/patch-package\"\u003epatch-package\u003c/a\u003e を使うことで対応することができた。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003epatch-package\u003c/code\u003e を使う際はまず \u003ccode\u003enode_modules\u003c/code\u003e の中身のファイルを必要に応じて書き換えて、その後に以下のコマンドを使うことでパッチファイルが作成できた。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-sh\"\u003enpx patch-package [パッケージ名]\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eパッチを反映させるには、\u003ccode\u003epostinstall\u003c/code\u003e 等のスクリプトで \u003ccode\u003epatch-package\u003c/code\u003e を実行することによって作成したパッチの内容が \u003ccode\u003enode_modules\u003c/code\u003e に反映された。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-json\"\u003e{\n  \"scripts\": {\n    \"postinstall\": \"patch-package\"\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e\u003ccode\u003epnpm\u003c/code\u003e での対応\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003epnpm\u003c/code\u003e では \u003ccode\u003enode_modules\u003c/code\u003e が symlink で管理されているため \u003ccode\u003enode_modules\u003c/code\u003e を直接書き換える対応は行えない。\u003ccode\u003epatch-package\u003c/code\u003e も \u003ccode\u003epnpm\u003c/code\u003e には非対応である。\u003c/p\u003e\n\u003cp\u003eその代わり、\u003ccode\u003epnpm\u003c/code\u003e は独自のパッチ機構を持っている。\u003c/p\u003e\n\u003ch2\u003e\u003ccode\u003epnpm patch\u003c/code\u003e\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://pnpm.io/cli/patch\"\u003epnpm patch\u003c/a\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-sh\"\u003epnpm patch \u0026#x3C;pkg name\u003e@\u0026#x3C;version\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e実行すると以下の様なメッセージが表示され、パッケージの内容が作成される\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eYou can now edit the following folder: /private/var/folders/5t/lpfk4v1s7fqcpf1k1yjnnv3w0000gn/T/d9cfbc08a0261088f439bb943285e960\n\nOnce you're done with your changes, run \"pnpm patch-commit /private/var/folders/5t/lpfk4v1s7fqcpf1k1yjnnv3w0000gn/T/d9cfbc08a0261088f439bb943285e960\"\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e作成されたフォルダの中で必要な変更を行い、以下のコマンドを実行すると\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-sh\"\u003epnpm patch-commit [作成されたフォルダのパス]\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e特に他の指定をしてない場合、プロジェクトに\u003ccode\u003epatches\u003c/code\u003eフォルダが作成され、そこにパッチファイルが生成される。\u003c/p\u003e\n\u003cp\u003eまた、\u003ccode\u003epackage.json\u003c/code\u003eに以下のような記述が追記される。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-json\"\u003e{\n  \"pnpm\": {\n    \"patchedDependencies\": {\n      \"package@1.0.0\": \"patches/@package@1.0.0.patch\"\n    }\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eこれで次回から\u003ccode\u003epnpm install\u003c/code\u003eを実行する際にパッチファイルが適用される。\u003c/p\u003e\n"])</script><script>self.__next_f.push([1,"4:[\"$\",\"$L8\",null,{\"title\":\"naturalclar.dev\",\"children\":[[\"$\",\"h1\",null,{\"children\":\"patching-with-pnpm\"}],[\"$\",\"p\",null,{\"style\":{\"display\":\"block\",\"marginBottom\":\"16px\"},\"children\":\"January 06, 2024\"}],[\"$\",\"div\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$d\"}}],[\"$\",\"hr\",null,{\"style\":{\"marginBottom\":\"16px\"}}],[\"$\",\"div\",null,{\"style\":{\"display\":\"flex\",\"alignItems\":\"center\",\"marginBottom\":\"40px\"},\"children\":[[\"$\",\"$Le\",null,{\"src\":\"https://www.github.com/Naturalclar.png\",\"width\":50,\"height\":50,\"alt\":\"Naturalclar (Jesse Katsumata)\",\"style\":{\"marginRight\":\"16px\",\"marginBottom\":0,\"minWidth\":50,\"borderRadius\":\"100%\"}}],[\"$\",\"div\",null,{\"style\":{\"display\":\"flex\",\"flexDirection\":\"column\",\"gap\":\"8px\"},\"children\":[[\"$\",\"p\",null,{\"style\":{\"margin\":0},\"children\":[\"Author: \",[\"$\",\"strong\",null,{\"children\":\"Naturalclar (Jesse Katsumata)\"}]]}],[\"$\",\"p\",null,{\"style\":{\"margin\":0},\"children\":[[\"$\",\"a\",null,{\"href\":\"https://x.com/natural_clar\",\"children\":\"X\"}],\" \",[\"$\",\"a\",null,{\"href\":\"https://www.github.com/Naturalclar\",\"children\":\"Github\"}]]}]]}]]}],[\"$\",\"ul\",null,{\"style\":{\"display\":\"flex\",\"flexWrap\":\"wrap\",\"justifyContent\":\"space-between\",\"listStyle\":\"none\",\"padding\":0},\"children\":[[\"$\",\"li\",null,{\"children\":[\"$\",\"$L9\",null,{\"href\":\"/posts/setting-up-nvim-setting-for-windows-powershell\",\"rel\":\"prev\",\"children\":[\"← \",\"Windows の PowerShell で dotfiles にある neovim 用の init.vim を設定する方法\"]}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"$L9\",null,{\"href\":\"/posts/writing-native-module-in-swift\",\"rel\":\"next\",\"children\":[\"React Native の Native Module を Swift で書く\",\" →\"]}]}]]}]]}]\n"])</script><script>self.__next_f.push([1,"a:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"patching-with-pnpm | naturalclar.dev\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"\\n## `pnpm` で `node_modules` 内のパッケージにパッチを当てる方法\\n\\nプロジェクトで `node_modules` の中にある特定のパッケージに変更を加える必要がある場面に直面した。\\n\\n### `yarn` v1 での対応\\n\\n以前はパッケージマネージャとして `yarn` v1 を採用していて、その時は [patch-package](https://github.com/...\"}],[\"$\",\"meta\",\"4\",{\"name\":\"author\",\"content\":\"Naturalclar (Jesse Katsumata)\"}],[\"$\",\"meta\",\"5\",{\"name\":\"keywords\",\"content\":\"react, react-native, nextjs, blog\"}],[\"$\",\"meta\",\"6\",{\"name\":\"creator\",\"content\":\"Naturalclar (Jesse Katsumata)\"}],[\"$\",\"meta\",\"7\",{\"name\":\"publisher\",\"content\":\"Naturalclar (Jesse Katsumata)\"}],[\"$\",\"meta\",\"8\",{\"name\":\"robots\",\"content\":\"index, follow\"}],[\"$\",\"meta\",\"9\",{\"property\":\"og:title\",\"content\":\"patching-with-pnpm | naturalclar.dev\"}],[\"$\",\"meta\",\"10\",{\"property\":\"og:description\",\"content\":\"\\n## `pnpm` で `node_modules` 内のパッケージにパッチを当てる方法\\n\\nプロジェクトで `node_modules` の中にある特定のパッケージに変更を加える必要がある場面に直面した。\\n\\n### `yarn` v1 での対応\\n\\n以前はパッケージマネージャとして `yarn` v1 を採用していて、その時は [patch-package](https://github.com/...\"}],[\"$\",\"meta\",\"11\",{\"property\":\"og:url\",\"content\":\"https://blog.naturalclar.dev/\"}],[\"$\",\"meta\",\"12\",{\"property\":\"og:site_name\",\"content\":\"naturalclar.dev\"}],[\"$\",\"meta\",\"13\",{\"property\":\"og:image\",\"content\":\"https://blog.naturalclar.dev/twitter-card.png\"}],[\"$\",\"meta\",\"14\",{\"property\":\"og:image:width\",\"content\":\"1200\"}],[\"$\",\"meta\",\"15\",{\"property\":\"og:image:height\",\"content\":\"630\"}],[\"$\",\"meta\",\"16\",{\"property\":\"og:image:alt\",\"content\":\"patching-with-pnpm\"}],[\"$\",\"meta\",\"17\",{\"property\":\"og:type\",\"content\":\"website\"}],[\"$\",\"meta\",\"18\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"19\",{\"name\":\"twitter:creator\",\"content\":\"@natural_clar\"}],[\"$\",\"meta\",\"20\",{\"name\":\"twitter:title\",\"content\":\"patching-with-pnpm | naturalclar.dev\"}],[\"$\",\"meta\",\"21\",{\"name\":\"twitter:description\",\"content\":\"\\n## `pnpm` で `node_modules` 内のパッケージにパッチを当てる方法\\n\\nプロジェクトで `node_modules` の中にある特定のパッケージに変更を加える必要がある場面に直面した。\\n\\n### `yarn` v1 での対応\\n\\n以前はパッケージマネージャとして `yarn` v1 を採用していて、その時は [patch-package](https://github.com/...\"}],[\"$\",\"meta\",\"22\",{\"name\":\"twitter:image\",\"content\":\"https://blog.naturalclar.dev/twitter-card.png\"}]]\n"])</script><script>self.__next_f.push([1,"3:null\n"])</script></body></html>